<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Musoucrow' BLOG" />





  <link rel="alternate" href="/atom.xml" title="Musoucrow' BLOG" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Musoucrow' BLOG">
<meta property="og:url" content="https://musoucrow.github.io/page/5/index.html">
<meta property="og:site_name" content="Musoucrow' BLOG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Musoucrow' BLOG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://musoucrow.github.io/page/5/"/>





  <title> Musoucrow' BLOG </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Musoucrow' BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/08/26/frame_sync/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/26/frame_sync/" itemprop="url">
                  帧同步的初步探究
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-26T17:30:16+08:00">
                2017-08-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/26/frame_sync/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/08/26/frame_sync/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/26/frame_sync/" class="leancloud_visitors" data-flag-title="帧同步的初步探究">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　在阅读这篇文章之前，你需要了解一下何为<a href="http://www.skywind.me/blog/archives/131" target="_blank" rel="external">帧同步</a>。关于帧同步的实现尝试，其实近年来一直都有不间断的尝试，不过大多浅尝辄止，这次总算是一次较为完整的实现了。接下来便对这次实现介绍一二。</p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><p>　　本次项目使用的开发引擎为<a href="https://love2d.org" target="_blank" rel="external">LÖVE</a>，<a href="https://git.coding.net/musoucrow/FrameSync.git" target="_blank" rel="external">项目地址在此</a>。以下是运行演示（外网联机测试也通过了）：<img src="https://musoucrow.github.io/images/frame_sync/1.png" alt="1"><br>　　由于我并没有什么服务端开发的相关经验，所以只是使用了个简单的UDP网络库——<a href="http://enet.bespin.org/index.html" target="_blank" rel="external">ENet</a>。客户端与服务端共同处于一个项目下，非常的浅薄，以下是服务端与客户端的代码展示。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--server.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Enet = <span class="built_in">require</span> (<span class="string">"enet"</span>)</div><div class="line"><span class="keyword">local</span> Lib = <span class="built_in">require</span>(<span class="string">"lib"</span>)</div><div class="line"></div><div class="line"><span class="keyword">local</span> host = Enet.host_create(<span class="string">"localhost:6789"</span>)</div><div class="line"><span class="keyword">local</span> peerMap = &#123;&#125;</div><div class="line"><span class="keyword">local</span> dataMap = &#123;&#125;</div><div class="line"><span class="keyword">local</span> inputMap = &#123;&#125;</div><div class="line"><span class="keyword">local</span> playList = &#123;&#125;</div><div class="line"><span class="keyword">local</span> playFrame = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> frame = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> userCount = <span class="number">0</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"start"</span>)</div><div class="line"></div><div class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) <span class="keyword">do</span></div><div class="line">	<span class="keyword">local</span> event = host:service(<span class="number">17</span>)</div><div class="line">	</div><div class="line">	<span class="keyword">while</span> (event) <span class="keyword">do</span></div><div class="line">		<span class="keyword">local</span> <span class="built_in">type</span>, ip, data = Lib.Recv(event)</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (<span class="built_in">type</span> == <span class="string">"input"</span>) <span class="keyword">then</span></div><div class="line">			inputMap[ip] = data</div><div class="line">		<span class="keyword">elseif</span> (<span class="built_in">type</span> == <span class="string">"connect"</span>) <span class="keyword">then</span></div><div class="line">			event.peer:timeout(<span class="number">10</span>, <span class="number">3000</span>, <span class="number">5000</span>)</div><div class="line">			<span class="keyword">local</span> data = &#123;ip = ip, x = <span class="built_in">math</span>.random(<span class="number">0</span>, <span class="number">800</span>), y = <span class="built_in">math</span>.random(<span class="number">0</span>, <span class="number">600</span>)&#125;</div><div class="line">			</div><div class="line">			<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(peerMap) <span class="keyword">do</span></div><div class="line">				Lib.Send(v, <span class="string">"addNewUser"</span>, data)</div><div class="line">			<span class="keyword">end</span></div><div class="line">			</div><div class="line">			peerMap[ip] = event.peer</div><div class="line">			dataMap[ip] = data</div><div class="line">			inputMap[ip] = &#123;&#125;</div><div class="line">			userCount = userCount + <span class="number">1</span></div><div class="line">			</div><div class="line">			Lib.Send(event.peer, <span class="string">"loginSuccess"</span>, &#123;ip = ip, users = dataMap, playList = playList&#125;)</div><div class="line">			</div><div class="line">			<span class="built_in">print</span>(<span class="string">"connect"</span>, ip)</div><div class="line">		<span class="keyword">elseif</span> (<span class="built_in">type</span> == <span class="string">"disconnect"</span>) <span class="keyword">then</span></div><div class="line">			peerMap[ip] = <span class="keyword">nil</span></div><div class="line">			dataMap[ip] = <span class="keyword">nil</span></div><div class="line">			inputMap[ip] = <span class="keyword">nil</span></div><div class="line">			userCount = userCount - <span class="number">1</span></div><div class="line">			</div><div class="line">			<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(peerMap) <span class="keyword">do</span></div><div class="line">				Lib.Send(v, <span class="string">"delUser"</span>, ip)</div><div class="line">			<span class="keyword">end</span></div><div class="line">			</div><div class="line">			event.peer:disconnect(<span class="number">-1</span>)</div><div class="line">			<span class="built_in">print</span>(<span class="string">"disconnect"</span>, ip)</div><div class="line">		<span class="keyword">end</span></div><div class="line">		</div><div class="line">		event = host:service()</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (userCount &gt; <span class="number">0</span>) <span class="keyword">then</span></div><div class="line">		frame = frame + <span class="number">1</span></div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (frame % <span class="number">3</span> == <span class="number">0</span>) <span class="keyword">then</span></div><div class="line">			playFrame = playFrame + <span class="number">1</span></div><div class="line">			<span class="built_in">print</span>(playFrame)</div><div class="line">			</div><div class="line">			<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(peerMap) <span class="keyword">do</span></div><div class="line">				Lib.Send(v, <span class="string">"play"</span>, inputMap)</div><div class="line">			<span class="keyword">end</span></div><div class="line">			</div><div class="line">			playList[#playList + <span class="number">1</span>] = Lib.Clone(inputMap)</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--main.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Actor = <span class="built_in">require</span>(<span class="string">"actor"</span>)</div><div class="line"><span class="keyword">local</span> Lib = <span class="built_in">require</span>(<span class="string">"lib"</span>)</div><div class="line"><span class="keyword">local</span> Enet = <span class="built_in">require</span> (<span class="string">"enet"</span>)</div><div class="line"></div><div class="line"><span class="keyword">local</span> userList = &#123;&#125;</div><div class="line"><span class="keyword">local</span> userMap = &#123;&#125;</div><div class="line"><span class="keyword">local</span> input = &#123;&#125;</div><div class="line"><span class="keyword">local</span> playList = &#123;&#125;</div><div class="line"><span class="keyword">local</span> playFrame = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> perdt = <span class="number">17</span></div><div class="line"><span class="keyword">local</span> timer = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> frame = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> player</div><div class="line"><span class="keyword">local</span> fps = <span class="number">0</span></div><div class="line"><span class="keyword">local</span> timer2 = <span class="number">0</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> host = Enet.host_create()</div><div class="line"><span class="keyword">local</span> server = host:connect(<span class="string">"localhost:6789"</span>)</div><div class="line"></div><div class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">NewActor</span><span class="params">(x, y, ip)</span></span></div><div class="line">	<span class="keyword">local</span> actor = Actor.New(x, y, ip)</div><div class="line">	userMap[ip] = actor</div><div class="line">	userList[#userList + <span class="number">1</span>] = actor</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> actor</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">Update</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">if</span> ((frame + <span class="number">1</span>) % <span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> #playList == <span class="number">0</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	frame = frame + <span class="number">1</span></div><div class="line">	fps = fps + <span class="number">1</span></div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (frame % <span class="number">3</span> == <span class="number">0</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(playList[<span class="number">1</span>]) <span class="keyword">do</span></div><div class="line">			<span class="keyword">if</span> (userMap[k]) <span class="keyword">then</span></div><div class="line">				userMap[k].input = v</div><div class="line">			<span class="keyword">end</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">		</div><div class="line">		playFrame = playFrame + <span class="number">1</span></div><div class="line">		<span class="built_in">table</span>.remove(playList, <span class="number">1</span>)</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">for</span> n=<span class="number">1</span>, #userList <span class="keyword">do</span></div><div class="line">		userList[n]:Update()</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.load</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">local</span> event, <span class="built_in">type</span>, ip, data</div><div class="line">	</div><div class="line">	<span class="keyword">repeat</span></div><div class="line">		event = host:service()</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (event) <span class="keyword">then</span></div><div class="line">			<span class="built_in">type</span>, ip, data = Lib.Recv(event)</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">until</span> event ~= <span class="keyword">nil</span> <span class="keyword">and</span> <span class="built_in">type</span> == <span class="string">"loginSuccess"</span></div><div class="line"></div><div class="line">	<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(data.users) <span class="keyword">do</span></div><div class="line">		<span class="keyword">local</span> actor = NewActor(v.x, v.y, v.ip)</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (v.ip == data.ip) <span class="keyword">then</span></div><div class="line">			player = actor</div><div class="line">			<span class="built_in">print</span>(<span class="string">"loginSuccess"</span>, v.ip)</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	playList = data.playList</div><div class="line">	</div><div class="line">	<span class="keyword">while</span> (#playList &gt; <span class="number">0</span>) <span class="keyword">do</span></div><div class="line">		Update()</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.update</span><span class="params">(dt)</span></span></div><div class="line">	<span class="keyword">local</span> event = host:service()</div><div class="line">	</div><div class="line">	<span class="keyword">while</span> event <span class="keyword">do</span></div><div class="line">		<span class="keyword">local</span> <span class="built_in">type</span>, ip, data = Lib.Recv(event)</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (<span class="built_in">type</span> == <span class="string">"play"</span>) <span class="keyword">then</span></div><div class="line">			playList[#playList + <span class="number">1</span>] = data</div><div class="line">		<span class="keyword">elseif</span> (<span class="built_in">type</span> == <span class="string">"addNewUser"</span>) <span class="keyword">then</span></div><div class="line">			NewActor(data.x, data.y, data.ip)</div><div class="line">		<span class="keyword">elseif</span> (<span class="built_in">type</span> == <span class="string">"delUser"</span>) <span class="keyword">then</span></div><div class="line">			userMap[data] = <span class="keyword">nil</span></div><div class="line">			</div><div class="line">			<span class="keyword">for</span> n=#userList, <span class="number">1</span>, <span class="number">-1</span> <span class="keyword">do</span></div><div class="line">				<span class="keyword">if</span> (userList[n].ip == data) <span class="keyword">then</span></div><div class="line">					<span class="built_in">table</span>.remove(userList, n)</div><div class="line">				<span class="keyword">end</span></div><div class="line">			<span class="keyword">end</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">		</div><div class="line">		event = host:service()</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	dt = <span class="built_in">math</span>.floor(dt * <span class="number">1000</span>)</div><div class="line">	timer = timer + dt</div><div class="line">	</div><div class="line">	<span class="keyword">while</span> (timer &gt;= perdt) <span class="keyword">do</span></div><div class="line">		<span class="comment">--print(#playList)</span></div><div class="line">		<span class="keyword">if</span> ((frame + <span class="number">1</span>) % <span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> #playList &gt; <span class="number">1</span>) <span class="keyword">then</span></div><div class="line">			<span class="keyword">while</span> (#playList &gt; <span class="number">0</span>) <span class="keyword">do</span></div><div class="line">				Update()</div><div class="line">			<span class="keyword">end</span></div><div class="line">		<span class="keyword">else</span></div><div class="line">			Update()</div><div class="line">		<span class="keyword">end</span></div><div class="line">		</div><div class="line">		timer = timer - perdt</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	timer2 = timer2 + dt</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (timer2 &gt;= <span class="number">1000</span>) <span class="keyword">then</span></div><div class="line">		<span class="comment">--print(timer2, fps)</span></div><div class="line">		fps = <span class="number">0</span></div><div class="line">		timer2 = timer2 - <span class="number">1000</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.draw</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">for</span> n=<span class="number">1</span>, #userList <span class="keyword">do</span></div><div class="line">		userList[n]:Draw()</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	love.graphics.<span class="built_in">print</span>(playFrame, <span class="number">5</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.keypressed</span><span class="params">(key)</span></span></div><div class="line">	<span class="keyword">if</span> (key == <span class="string">"up"</span> <span class="keyword">or</span> key == <span class="string">"down"</span> <span class="keyword">or</span> key == <span class="string">"left"</span> <span class="keyword">or</span> key == <span class="string">"right"</span>) <span class="keyword">then</span></div><div class="line">		input[key] = <span class="number">1</span></div><div class="line">		Lib.Send(server, <span class="string">"input"</span>, input)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.keyreleased</span><span class="params">(key)</span></span></div><div class="line">	<span class="keyword">if</span> (key == <span class="string">"up"</span> <span class="keyword">or</span> key == <span class="string">"down"</span> <span class="keyword">or</span> key == <span class="string">"left"</span> <span class="keyword">or</span> key == <span class="string">"right"</span>) <span class="keyword">then</span></div><div class="line">		input[key] = <span class="number">0</span></div><div class="line">		Lib.Send(server, <span class="string">"input"</span>, input)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>　　从代码中可以看出，以上实现便是Skywind所说的<strong>乐观帧锁定</strong>。事实上我认为传统的帧同步（Lockstep）并不适合网络游戏，甚至只是一种早期的理论模型。在实际应用还是要以乐观帧锁定为准。关于乐观帧锁定的实现原理我便不再复述，只说说实际开发中遇到的一些问题。  </p>
<h3 id="Fixed-Update"><a href="#Fixed-Update" class="headerlink" title="Fixed Update"></a>Fixed Update</h3><p>　　很抱歉我找不到这个词对应的中文词汇，直译过来的意思便是“固定的更新”。在实际应用的含义为，每隔一段时间便会Update一次，如果遇到卡住之类导致积累了很长时间的行为，则会根据时间一次性进行多次Update。也就是这段代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--Fixed Update(main.lua)</span></div><div class="line"></div><div class="line">timer = timer + dt</div><div class="line"></div><div class="line"><span class="keyword">while</span> (timer &gt;= perdt) <span class="keyword">do</span></div><div class="line">    <span class="keyword">if</span> ((frame + <span class="number">1</span>) % <span class="number">3</span> == <span class="number">0</span> <span class="keyword">and</span> #playList &gt; <span class="number">1</span>) <span class="keyword">then</span></div><div class="line">        <span class="keyword">while</span> (#playList &gt; <span class="number">0</span>) <span class="keyword">do</span></div><div class="line">            Update()</div><div class="line">        <span class="keyword">end</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        Update()</div><div class="line">    <span class="keyword">end</span></div><div class="line">    </div><div class="line">    timer = timer - perdt</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>　　使用了Fixed Update后，你的游戏进度便由时间牢牢把控住，这样便能摆脱帧率的影响。在业务层也不再需要使用DT(Delta Time)了，而是采用一个固定的值（譬如1 / 60）。这个概念很重要，因为过快与过慢的帧率都会与同步不那么搭调。</p>
<h3 id="收发频率"><a href="#收发频率" class="headerlink" title="收发频率"></a>收发频率</h3><p>　　按照Skywind的说法是服务端每秒20-50次向所有客户端发送同步包。这里我们需要理清乐观帧锁定的本质：<strong>就是服务端每隔一段时间发送同步包，然后客户端每隔一段时间接收并应用之，如果在那段时间内没有收到，就持续等待。</strong>所以我们必须设置好合适的时间，令服务端和客户端之间配合无间。<br>　　在我的设计里，为服务端和客户端都设置了帧（Frame）的概念，每Update一次即是一帧，每次Update的间隔时间为<em>17毫秒</em>，这个数字是根据(1/60)秒取整得出。每隔三帧服务端便会发送同步包，而客户端则是每帧都会接收，每隔三帧便会应用之。我称这种每隔三帧的帧为<strong>同步帧</strong>。<br>　　衡量设置是否良好，主要看每帧接收的同步包的数量，以及每秒帧数的多少。正常情况下，每帧接收的同步包的数量应是0-1，如果超过这个数值，证明服务端或客户端其中一方的频率太快或太慢。至于每秒帧数的多少，则能看出发送频率是否过剩，正常情况下在60左右即可，这和FPS的要求是类似的。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> event = host:service(<span class="number">17</span>) <span class="comment">--服务端每隔17毫秒接收一次封包</span></div></pre></td></tr></table></figure>
<h3 id="收包Q-amp-A"><a href="#收包Q-amp-A" class="headerlink" title="收包Q&amp;A"></a>收包Q&amp;A</h3><ul>
<li>关于收包的问题，有个最明显的问题便是为何不是在同步帧时进行收包，而是每帧都尝试收包？<ul>
<li>这是因为收包的内容不仅仅是关于帧同步，还可能有其他东西。其次便是先收后收并不影响什么，以及每隔三帧才进行一次收包恐怕会卡。</li>
</ul>
</li>
<li>关于一次性收到多个同步包的情况时，该怎么办？<ul>
<li>遇到收到多个同步包的情况，说明客户端失联了一段时间，这时候便需要一次性进行多次Update以迅速追回进度。</li>
</ul>
</li>
<li>既然确定遇到多个同步包时需要一次性追回进度，那为何不选择在接收后立即执行，而要等到同步帧？<ul>
<li>因为基本上不会遇到这种情况，能遇到多个同步包的情况，一般客户端已经在等待了。换做客户端卡住这种情况的话，根据Fixed Update的规则，本来就会立即赶到同步帧的。</li>
</ul>
</li>
<li>为何等待同步包的代码并非是阻塞式的，而是每帧去判定一下？<ul>
<li>因为如果是阻塞式的话，会使得DT变得很大，影响Fixed Update。</li>
</ul>
</li>
</ul>
<h3 id="输入应用"><a href="#输入应用" class="headerlink" title="输入应用"></a>输入应用</h3><p>　　关于输入应用方面，首先要明确一点：客户端每次按下/释放按键，就会改写输入表然后发送之。服务端收到后便会改写在服务端的对应输入表。这种模式在高延迟的表现便是呈现出某些按键因为一直按下而导致一些鬼畜操作，这点算是可以接受的。<br>　　另外注意不要贪图方便每次只发送当前修改的按键，这样会失去输入的稳定性，一旦发生丢包之类的，会产生键盘失灵的感觉。<br>　　在每次同步帧时便会根据同步包的内容更新所有玩家的输入表，从而改变每个联机角色的操作。这个输入表会一直应用到下次同步帧之前，从这点来看帧同步也是一种回合制。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--根据同步包的内容更新所有玩家的输入表(main.lua)</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (frame % <span class="number">3</span> == <span class="number">0</span>) <span class="keyword">then</span></div><div class="line">	<span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(playList[<span class="number">1</span>]) <span class="keyword">do</span></div><div class="line">		<span class="keyword">if</span> (userMap[k]) <span class="keyword">then</span></div><div class="line">			userMap[k].input = v</div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	playFrame = playFrame + <span class="number">1</span></div><div class="line">	<span class="built_in">table</span>.remove(playList, <span class="number">1</span>)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--客户端每次按下/释放按键，就会改写输入表然后发送之(main.lua)</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.keypressed</span><span class="params">(key)</span></span></div><div class="line">	<span class="keyword">if</span> (key == <span class="string">"up"</span> <span class="keyword">or</span> key == <span class="string">"down"</span> <span class="keyword">or</span> key == <span class="string">"left"</span> <span class="keyword">or</span> key == <span class="string">"right"</span>) <span class="keyword">then</span></div><div class="line">		input[key] = <span class="number">1</span></div><div class="line">		Lib.Send(server, <span class="string">"input"</span>, input)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.keyreleased</span><span class="params">(key)</span></span></div><div class="line">	<span class="keyword">if</span> (key == <span class="string">"up"</span> <span class="keyword">or</span> key == <span class="string">"down"</span> <span class="keyword">or</span> key == <span class="string">"left"</span> <span class="keyword">or</span> key == <span class="string">"right"</span>) <span class="keyword">then</span></div><div class="line">		input[key] = <span class="number">0</span></div><div class="line">		Lib.Send(server, <span class="string">"input"</span>, input)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="断线重连-中途加入"><a href="#断线重连-中途加入" class="headerlink" title="断线重连/中途加入"></a>断线重连/中途加入</h3><p>　　想要做到这两点，便需要做到在服务端保存每一份同步包，这样服务端只需要记录每个玩家的初始数据，在新玩家加入游戏时，首先发送每个玩家的初始数据给新玩家同步，然后再把所有同步包打包发送给新玩家，让新玩家一次性Update，即可完成中途加入。当然不要忘记给现有玩家发送新玩家的数据。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--新玩家同步(main.lua)</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> event, <span class="built_in">type</span>, ip, data</div><div class="line"></div><div class="line"><span class="keyword">repeat</span></div><div class="line">	event = host:service()</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (event) <span class="keyword">then</span></div><div class="line">		<span class="built_in">type</span>, ip, data = Lib.Recv(event)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">until</span> event ~= <span class="keyword">nil</span> <span class="keyword">and</span> <span class="built_in">type</span> == <span class="string">"loginSuccess"</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(data.users) <span class="keyword">do</span></div><div class="line">	<span class="keyword">local</span> actor = NewActor(v.x, v.y, v.ip)</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (v.ip == data.ip) <span class="keyword">then</span></div><div class="line">		player = actor</div><div class="line">		<span class="built_in">print</span>(<span class="string">"loginSuccess"</span>, v.ip)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">playList = data.playList</div><div class="line"></div><div class="line"><span class="keyword">while</span> (#playList &gt; <span class="number">0</span>) <span class="keyword">do</span></div><div class="line">	Update()</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h3><p>　　根据网上的信息看来，浮点数因为在不同环境的实现有所偏差，所以可能会导致不一致的问题，这样便会产生蝴蝶效应，最终导致同步失效。目前我使用LuaJIT在Windows(x64)、Ubuntu(x64)、macOS、Android(红米Note4)、iOS测试来看，浮点数在「输出」的场合下并无不同。当然只是输出，并不能代表真实数据的情况。以及我的测试范本并不算多，对于浮点数的问题还不敢保证。所以我选择在业务层放弃使用浮点数，相关数据都事先进行转换，到最后需要浮点数的对接场合再进行转换。当然我并不敢保证这种做法的可行性，真正成熟的做法应该是使用定点数，但我暂时并未这么做。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dt = <span class="built_in">math</span>.floor(dt * <span class="number">1000</span>) <span class="comment">-- 浮点数转换为整数（毫秒）</span></div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　以上便是本次我对帧同步的初步探究，它注定是不成熟的，需要经过实践的检验，接下来我会考虑将其接入到一些项目中。有相关经验的朋友欢迎前来讨论。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/07/21/spk_analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/21/spk_analysis/" itemprop="url">
                  DNF的SPK文件解析笔记
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-21T15:57:42+08:00">
                2017-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Analysis/" itemprop="url" rel="index">
                    <span itemprop="name">Analysis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/21/spk_analysis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/21/spk_analysis/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/07/21/spk_analysis/" class="leancloud_visitors" data-flag-title="DNF的SPK文件解析笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　SPK文件是<a href="http://dnf.qq.com" target="_blank" rel="external">DNF</a>的一种更新时所用的压缩包（国服除外），在更新时会从服务器下载这种SPK文件然后于本地解压。有时候为了获得更快的速度，以及突破墙的限制，我们通过获取到更新服务器的网址直接下载。但是此刻对于如何将SPK文件解压便是个问题了，本文遂由此而生。</p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><p>　　SPK文件的本质上是将原文件按照一定规则进行分割成多个片段，然后对这些片段使用<a href="http://www.bzip.org" target="_blank" rel="external">bzip2</a>算法进行压缩。以下是文件结构图：<img src="https://musoucrow.github.io/images/spk_analysis/1.png" alt="1"></p>
<p>　　由于信息的不对称，导致不少地方是处于盲区的，不过这并不影响获取到关键数据。这种被压缩的片段开头标识为”BZh91AY&amp;SY”，所以只需要以此为关键字进行分割就能得出关键数据了，不过实际操作时发现除了压缩数据之外还有非压缩数据，并且会用一段48字节的数据进行分隔。且拥有非压缩数据的片段结尾也会有一段意味不明的数据，好在它们都有对应的开头标识，进行分割即可。<br>　　在得出压缩数据后使用bzip2算法进行解压缩，然后将所有解压后的数据与非压缩数据按顺序进行拼接，每个片段如此类推最后总体拼接起来即可得到完整的原文件。本次解析使用的环境是Python3.6，以下是过程代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> bz2</div><div class="line"><span class="keyword">import</span> struct</div><div class="line"></div><div class="line"></div><div class="line">HEADER = <span class="string">b"BZh91AY&amp;SY"</span></div><div class="line">MARK = <span class="string">b"\x00\x00\x00\x00\x00\x10\x0e\x00\xff\xff\xff\xff\xff\xef\xf1\xff"</span></div><div class="line"><span class="comment"># 00 00 00 00 00 10 0E 00 FF FF FF FF FF EF F1 FF</span></div><div class="line">TAIL = <span class="string">b"\x01\x00\x00\x00"</span>  <span class="comment"># 01 00 00 00</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">decompress_spk</span><span class="params">(path)</span>:</span></div><div class="line">    f = open(path, <span class="string">"rb"</span>)</div><div class="line"></div><div class="line">    f.read(<span class="number">4</span>)  <span class="comment"># unknown, all files are same.</span></div><div class="line">    f.read(<span class="number">260</span>)  <span class="comment"># total 260 bits, contain name and buffer.</span></div><div class="line">    f.read(<span class="number">4</span>)  <span class="comment"># unknown, all files are same.</span></div><div class="line">    struct.unpack(<span class="string">'i'</span>, f.read(<span class="number">4</span>))[<span class="number">0</span>]  <span class="comment"># decompress_size</span></div><div class="line"></div><div class="line">    content = f.read()</div><div class="line">    parts = content.split(HEADER)</div><div class="line">    f.close()</div><div class="line"></div><div class="line">    new_content = <span class="string">b""</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, len(parts)):</div><div class="line">        lst = parts[n].split(MARK)</div><div class="line">        length = len(lst)</div><div class="line">        new_content = new_content + bz2.decompress(HEADER + lst[<span class="number">0</span>])</div><div class="line"></div><div class="line">        <span class="keyword">if</span> length &gt; <span class="number">1</span>:</div><div class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, length - <span class="number">1</span>):</div><div class="line">                new_content = new_content + lst[m][<span class="number">32</span>:]</div><div class="line"></div><div class="line">            pos = lst[length - <span class="number">1</span>].rfind(TAIL)</div><div class="line">            new_content = new_content + lst[length - <span class="number">1</span>][<span class="number">32</span>:pos]</div><div class="line"></div><div class="line">    f2 = open(path[:<span class="number">-4</span>], <span class="string">"wb"</span>)</div><div class="line">    f2.write(new_content)</div><div class="line">    f2.close()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span> <span class="keyword">and</span> len(sys.argv) &gt; <span class="number">1</span>:</div><div class="line">    decompress_spk(sys.argv[<span class="number">1</span>])</div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　事实上这种SPK的压缩机制效果根本是微乎其微，我完全不明白Neople这么做的用意。以及片段的划分机制和诸多盲区都没搞懂，看来我得考虑学下逆向方面的知识了。不过无论如何，最终要达到的目标还是做到了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/07/16/socket_listen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/16/socket_listen/" itemprop="url">
                  关于Socket.listen方法的一点体悟
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-16T11:58:36+08:00">
                2017-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/16/socket_listen/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/16/socket_listen/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/07/16/socket_listen/" class="leancloud_visitors" data-flag-title="关于Socket.listen方法的一点体悟">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　最近在接触<a href="https://docs.python.org/3/library/socket.html#module-socket" target="_blank" rel="external">Socket</a>的的时候，关于其中的listen方法感到不解，于是对其进行了一番研究，得出了一点体悟，特此记录。</p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><p>　　让我们先来看看listen方法在Python3.6文档说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">socket.listen([backlog])</div><div class="line"></div><div class="line">Enable a server to accept connections. If backlog is specified, it must be at least 0 (if it is lower, it is set to 0); it specifies the number of unaccepted connections that the system will allow before refusing new connections. If not specified, a default reasonable value is chosen.</div><div class="line">启用服务器以接受连接。如果指定backlog，则必须至少为0（如果低于0，则设置为0）；它指定系统在拒绝新连接之前将允许的未接受连接的数量。如果未指定，则选择默认的合理值。</div><div class="line"></div><div class="line">Changed in version 3.5: The backlog parameter is now optional.</div><div class="line">在版本3.5中已更改： backlog参数现在是可选的。</div></pre></td></tr></table></figure>
<p>　　起初我看了这说明想当然的以为是可以接入的Client上限，不过实践过后发现并非如此。在网上找的解答基本上就是文档所言的复述，后来请教了专业人士后，方知这涉及到Socket的底层知识。<br>　　在了解listen方法之前，首先我们需要了解connect方法和accept方法，以下是文档说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">socket.connect(address)</div><div class="line"></div><div class="line">Connect to a remote socket at address. (The format of address depends on the address family — see above.)</div><div class="line">在地址连接到远程套接字。（地址的格式取决于地址系列 - 请参见上文）</div><div class="line"></div><div class="line">If the connection is interrupted by a signal, the method waits until the connection completes, or raise a socket.timeout on timeout, if the signal handler doesn’t raise an exception and the socket is blocking or has a timeout. For non-blocking sockets, the method raises an InterruptedError exception if the connection is interrupted by a signal (or the exception raised by the signal handler).</div><div class="line">如果连接被信号中断，则该方法等待直到连接完成，或者如果信号处理程序没有引发异常并且套接字正在阻塞或者已经阻塞，则在超时时引入socket.timeout超时。对于非阻塞套接字，如果连接被信号中断（或由信号处理程序引发的异常），则该方法引发InterruptedError异常。</div><div class="line"></div><div class="line">Changed in version 3.5: The method now waits until the connection completes instead of raising an InterruptedError exception if the connection is interrupted by a signal, the signal handler doesn’t raise an exception and the socket is blocking or has a timeout (see the PEP 475 for the rationale).</div><div class="line">在版本3.5中已更改：该方法现在等待直到连接完成，而不是提高InterruptedError异常，如果连接被信号中断，信号处理程序不引发异常，套接字阻塞或超时（参见 PEP 475）。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">socket.accept()</div><div class="line"></div><div class="line">Accept a connection. The socket must be bound to an address and listening for connections. The return value is a pair (conn, address) where conn is a new socket object usable to send and receive data on the connection, and address is the address bound to the socket on the other end of the connection.</div><div class="line">接收一个连接.该socket 必须要绑定一个地址和监听连接.返回值是一对（conn， 地址）其中conn是新 t4 &gt; socket对象可用于在连接上发送和接收数据，address是连接另一端的套接字的地址。</div><div class="line"></div><div class="line">The newly created socket is non-inheritable.</div><div class="line">新创建的套接字non-inheritable。</div><div class="line"></div><div class="line">Changed in version 3.4: The socket is now non-inheritable.</div><div class="line">在版本3.4中更改：套接字现在是不可继承的。</div><div class="line"></div><div class="line">Changed in version 3.5: If the system call is interrupted and the signal handler does not raise an exception, the method now retries the system call instead of raising an InterruptedError exception (see PEP 475 for the rationale).</div><div class="line">在版本3.5中更改：如果系统调用中断并且信号处理程序没有引发异常，则此方法现在重试系统调用，而不是引发InterruptedError异常 PEP 475）。</div></pre></td></tr></table></figure>
<p>　　相比listen方法，它俩就好理解多了，一个是Client用于连接Server的方法，一个是Server用于接收Client的连接申请的方法。<br>　　但事实上accept方法一次只能接收一个Client的连接申请，而Client则是多个的，这样Socket会设计一个队列来存储Client的连接申请则是理所当然的。于是accept便从这个队列里提取首位成员处理即可。以下是示意图：<img src="https://musoucrow.github.io/images/socket_listen/1.png" alt="1"></p>
<p>　　如此便很清晰了，backlog参数的含义便是这个队列的最大值，也就是同时受理连接申请的最大值。关于backlog该设置为多少，从<a href="https://github.com/cloudwu/skynet" target="_blank" rel="external">Skynet</a>得到的参考为32。如果满了便需要Client重新connect。以上listen方法之谜便解开了。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　不得不说网络编程的水真的很深，我也得买点书充充电了，目前的目标为啃下谢希仁著的《计算机网络》。另外推荐《TCP/IP详解》及《UNIX网络编程》。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/06/16/mvc_thinking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/16/mvc_thinking/" itemprop="url">
                  关于MVC框架的一点体悟
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-16T15:29:44+08:00">
                2017-06-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramDesign/" itemprop="url" rel="index">
                    <span itemprop="name">ProgramDesign</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/16/mvc_thinking/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/16/mvc_thinking/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/06/16/mvc_thinking/" class="leancloud_visitors" data-flag-title="关于MVC框架的一点体悟">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　<a href="http://baike.baidu.com/link?url=zYMmkOVIZhbMUbKeHEMyR3Ceg7j_KED4dv0puXavoS2QEVLUO-nmmpcadj1YtyOnnxQca5kxrX9t-v5UKZqoE0dkPehKNji5A5MzLJdQwbTm00psL_0txg8xMNWu0d9WEa896dz92JY-Kitfd5L3D_" target="_blank" rel="external">MVC框架</a>相信大家都有所耳闻，不过想必没有深入接触的话，大多是知其然而不知其所以然。而本人几乎没有GUI软件的开发经验，只是走马观花般的碰过几下.NET的Winform之类，所以之前自然也是如此。<br>　　而近日帮助友人使用C++/CLI完成一款篮球比赛记录软件，在思考要如何搭建架构时很自然的选择了将核心和界面分离的设计，在完成后我感觉Winform把自动生成的代码和人为实现的事件接口放一起很是冗杂。于是选择用Python重新实现一次，随着把界面数据和事件接口的分离，赫然发现：这不就是传说中的MVC框架么？<img src="https://musoucrow.github.io/images/mvc_thinking/directory.png" alt="directory"></p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><p>　　当然有一点是需要明确的：我实现的这套「MVC框架」并不算标准，并且为了便利性还牺牲了一点解耦性，以下仅供参考。<br>　　<img src="https://musoucrow.github.io/images/mvc_thinking/relationship.png" alt="relationship"><br>　　以上的core, interface, design分别是三个模块，代表着MVC框架下的model, controller, view。箭头表明了引用关系（例：interface调用了core的功能）。<br>　　如图所示，interface和design都引用了core，而core并没有引用其他模块。由此可见，core是完全独立于界面的，无论是怎样的界面，只要对接好core就没有问题，这正是「业务和界面分离」。<br>　　而interface和design，实际上是可以解耦的。不过这需要令design使用一些手段监听core的数据是否发生了变化，我认为这样的实现颇为复杂，况且interface和design本为一一对应的关系（interface是界面事件，design是界面数据），所以也不必苛求解耦。遂选择由interface通知design去同步core的数据。  </p>
<h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><p>　　本演示使用Python3编写，界面使用了<a href="https://riverbankcomputing.com/software/pyqt/intro" target="_blank" rel="external">Pyqt5</a>，理解这个演示你需要了解<a href="https://www.python.org" target="_blank" rel="external">Python</a>以及<a href="https://www.qt.io" target="_blank" rel="external">Qt</a>。项目地址:<a href="https://git.coding.net/musoucrow/MVCShow.git" target="_blank" rel="external">MVCShow.git</a><br>　　演示的内容十分简单，仅是一个窗口包含了一个文本框和按钮而已。通过点击按钮来改变文本框的内容。  </p>
<ul>
<li>点击前：<img src="https://musoucrow.github.io/images/mvc_thinking/before.png" alt="before"></li>
<li>点击后：<img src="https://musoucrow.github.io/images/mvc_thinking/after.png" alt="after"></li>
<li>流程图：<img src="https://musoucrow.github.io/images/mvc_thinking/progress.png" alt="progress"></li>
<li>代码展示：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># core</span></div><div class="line"></div><div class="line">__value = <span class="string">"123"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_value</span><span class="params">(value)</span>:</span></div><div class="line">    <span class="keyword">global</span> __value</div><div class="line">    __value = value</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_value</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> __value</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># design</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> core</div><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtCore, QtWidgets</div><div class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QMainWindow</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntryDesign</span><span class="params">(QMainWindow)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        super(EntryDesign, self).__init__()</div><div class="line"></div><div class="line">        self.setObjectName(<span class="string">"MVCShow"</span>)</div><div class="line">        self.resize(<span class="number">400</span>, <span class="number">300</span>)</div><div class="line">        self.pushButton = QtWidgets.QPushButton(self)</div><div class="line">        self.pushButton.setGeometry(QtCore.QRect(<span class="number">150</span>, <span class="number">210</span>, <span class="number">113</span>, <span class="number">32</span>))</div><div class="line">        self.pushButton.setObjectName(<span class="string">"pushButton"</span>)</div><div class="line">        self.lineEdit = QtWidgets.QLineEdit(self)</div><div class="line">        self.lineEdit.setGeometry(QtCore.QRect(<span class="number">150</span>, <span class="number">110</span>, <span class="number">113</span>, <span class="number">21</span>))</div><div class="line">        self.lineEdit.setObjectName(<span class="string">"lineEdit"</span>)</div><div class="line"></div><div class="line">        self.retranslateUi()</div><div class="line">        QtCore.QMetaObject.connectSlotsByName(self)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retranslateUi</span><span class="params">(self)</span>:</span></div><div class="line">        _translate = QtCore.QCoreApplication.translate</div><div class="line">        self.setWindowTitle(_translate(<span class="string">"MVCShow"</span>, <span class="string">"MVCShow"</span>))</div><div class="line">        self.pushButton.setText(_translate(<span class="string">"MVCShow"</span>, <span class="string">"click"</span>))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">refresh</span><span class="params">(self)</span>:</span></div><div class="line">        self.lineEdit.setText(core.get_value())</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># interface</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> core</div><div class="line"><span class="keyword">from</span> design.entry <span class="keyword">import</span> EntryDesign</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entry</span><span class="params">(EntryDesign)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, )</span>:</span></div><div class="line">        super(Entry, self).__init__()</div><div class="line">        self.pushButton.clicked.connect(self.__pushButton_clicked)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showEvent</span><span class="params">(self, event)</span>:</span></div><div class="line">        self.refresh()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__pushButton_clicked</span><span class="params">(self)</span>:</span></div><div class="line">        core.set_value(<span class="string">"456"</span>)</div><div class="line">        self.refresh()</div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　框架是死的，思想是活的。在实际开发中，并不需要教科书般地去套用模板，事实上大家实现的MVC框架也不尽相同。而我认为MVC框架的核心思想便是「界面与业务分离，数据与逻辑分离」。只要把握好这个核心思想去做即可。对此有所心得者，欢迎前来探讨，提供更佳的思路。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/05/01/png_stroke_problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/01/png_stroke_problem/" itemprop="url">
                  关于像素PNG图片在游戏引擎缩放后出现毛边的解决方案
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-01T06:35:55+08:00">
                2017-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teach/" itemprop="url" rel="index">
                    <span itemprop="name">Teach</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/01/png_stroke_problem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/01/png_stroke_problem/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/05/01/png_stroke_problem/" class="leancloud_visitors" data-flag-title="关于像素PNG图片在游戏引擎缩放后出现毛边的解决方案">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<p>　　今日遇到了一个很值得记录的问题：对于像素PNG图片在游戏引擎里缩放后，便会在图片边缘出现很奇怪的毛边。类似这样：<img src="https://musoucrow.github.io/images/png_stroke_problem/1.png" alt="1">  </p>
<p>　　经过研究发现，似乎与文件格式无关。我还尝试将不会出现毛边的像素图混搭一块，结果反而导致靠近毛边的地方会被感染：<img src="https://musoucrow.github.io/images/png_stroke_problem/2.png" alt="2"></p>
<p>　　当然这个问题在Unity下是可以通过设置解决的：<img src="https://musoucrow.github.io/images/png_stroke_problem/3.png" alt="3"></p>
<p>　　不过并非所有游戏引擎都能这么做的，所以还需要从文件根本上解决。经过一段无心插柳的尝试，发现解决方案为使用PS的文件→存储为Web所用格式：<img src="https://musoucrow.github.io/images/png_stroke_problem/4.png" alt="4"></p>
<p>　　关键便在于将杂边设置为“无”，保存后再拿去测试，问题解决：<img src="https://musoucrow.github.io/images/png_stroke_problem/5.png" alt="5"></p>
<p>　　虽然到头来具体的原理还是没有弄明白，但好歹也算是解决了。如果有人明白具体原理，还请不吝赐教。至于这么做是否有损尚未可知，但从肉眼来看是不成问题的。以及这个问题目前只发现出现在像素图上，带半透明的特效图并无此问题。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/04/21/caller/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/21/caller/" itemprop="url">
                  观察者模式的一种实现——Caller
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-21T16:55:56+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramDesign/" itemprop="url" rel="index">
                    <span itemprop="name">ProgramDesign</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/21/caller/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/21/caller/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/21/caller/" class="leancloud_visitors" data-flag-title="观察者模式的一种实现——Caller">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong>      </p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　在程序设计的时候，观察者模式是一种应用广泛的设计模式，它是一种模块间的通信方式，对于程序的解耦性有所帮助。本文便提供了一种实现思路，也即是说，你需要<strong>先去了解观察者模式</strong>才方便阅读本文。<br>　　以下代码演示将使用Lua语言，接下来的内容对阅读者的Lua水平有一定的要求。如果你不知道在Lua中class的实现方式，可参考<a href="http://blog.codingnow.com/2006/06/oo_lua.html" target="_blank" rel="external">这篇文章</a>。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>　　首先构造Caller的结构关系，如图所示：<img src="https://musoucrow.github.io/images/caller/relationship.png" alt="relationship"></p>
<p>　　由此可见，Caller包含一个结构体——Listener。接下来是代码实现：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- Caller.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> Caller = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:Ctor</span><span class="params">()</span></span></div><div class="line">	self.listenerList = &#123;&#125;</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:AddListener</span><span class="params">(obj, func)</span></span></div><div class="line">	<span class="built_in">table</span>.insert(self.listenerList, &#123;obj = obj, func = func&#125;) <span class="comment">-- Create Listener.</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:DelListener</span><span class="params">(obj, func)</span></span></div><div class="line">	<span class="keyword">for</span> n=#self.listenerList, <span class="number">1</span>, <span class="number">-1</span> <span class="keyword">do</span></div><div class="line">		<span class="keyword">if</span> (self.listenerList[n].obj == obj <span class="keyword">and</span> self.listenerList[n].func == func) <span class="keyword">then</span></div><div class="line">			<span class="built_in">table</span>.remove(self.listenerList, n)</div><div class="line">			</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="keyword">false</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:Call</span><span class="params">(...)</span></span></div><div class="line">	<span class="keyword">for</span> n=<span class="number">1</span>, #self.listenerList <span class="keyword">do</span></div><div class="line">		self.listenerList[n].func(self.listenerList[n].obj, ...)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> Caller</div></pre></td></tr></table></figure>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- A.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> Caller = <span class="built_in">require</span>(<span class="string">"caller"</span>)</div><div class="line"><span class="keyword">local</span> B = <span class="built_in">require</span>(<span class="string">"b"</span>)</div><div class="line"><span class="keyword">local</span> A = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:Ctor</span><span class="params">()</span></span></div><div class="line">	self.caller = Caller.New()</div><div class="line">	self.b = B.New(self.caller)</div><div class="line">	self.value = <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:SetValue</span><span class="params">(value)</span></span></div><div class="line">	self.value = value</div><div class="line">	self.caller:Call(value)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> A</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- B.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> B = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Ctor</span><span class="params">(caller)</span></span></div><div class="line">	caller:AddListener(self, self.Print)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Print</span><span class="params">(...)</span></span></div><div class="line">	<span class="built_in">print</span>(...)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> B</div></pre></td></tr></table></figure>
<p>　　如上所示，在调用A:SetValue(value)时会连带调用B:Print(…)，如此只需要通过操作Caller就能达到不同对象之间通信的效果。并且也无须将业务写死在A:SetValue(value)中，业务将集中存放在Caller中。</p>
<h2 id="疑难解答"><a href="#疑难解答" class="headerlink" title="疑难解答"></a>疑难解答</h2><p>　　问：Caller的缺点是什么？<br>　　答：Caller的缺点的很明显，需要将Caller对象直传到其他模块处，这样并不是很安全（别处也可以做Caller的一切行为）。当然这个问题也很好解决，只需要采用<a href="https://musoucrow.github.io/2017/04/19/event_mechanism/">Event机制</a>对其进行封装即可。代码如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- A.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> Caller = <span class="built_in">require</span>(<span class="string">"caller"</span>)</div><div class="line"><span class="keyword">local</span> B = <span class="built_in">require</span>(<span class="string">"b"</span>)</div><div class="line"><span class="keyword">local</span> A = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:Ctor</span><span class="params">()</span></span></div><div class="line">	self.event = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span> self:OnEvent(...) <span class="keyword">end</span></div><div class="line">	self.caller = Caller.New()</div><div class="line">	self.b = B.New()</div><div class="line">	self.value = <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:SetValue</span><span class="params">(value)</span></span></div><div class="line">	self.value = value</div><div class="line">	self.caller:Call(value)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:OnEvent</span><span class="params">(type, ...)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="built_in">type</span> == <span class="string">"AddListener"</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> self.caller:AddListener(...)</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="string">"No Event"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> A</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- B.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> B = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Ctor</span><span class="params">(upperEvent)</span></span></div><div class="line">	upperEvent(<span class="string">"AddListener"</span>, self, self.Print)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Print</span><span class="params">(...)</span></span></div><div class="line">	<span class="built_in">print</span>(...)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> B</div></pre></td></tr></table></figure>
<p>　　问：Caller在功能上有何可改进之处？<br>　　答：在实际开发中，Caller的需求数量一般不止一个，届时可以考虑用List或Map对Caller进行管理。也可以考虑直接让Caller具备管理多个ListenerList，代码如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- Caller.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> Caller = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:Ctor</span><span class="params">()</span></span></div><div class="line">	self.listenerListMap = &#123;&#125;</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:AddListener</span><span class="params">(type, obj, func)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">not</span> self.listenerListMap[<span class="built_in">type</span>]) <span class="keyword">then</span></div><div class="line">		self.listenerListMap[<span class="built_in">type</span>] = &#123;&#125;</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="built_in">table</span>.insert(self.listenerListMap[<span class="built_in">type</span>], &#123;obj = obj, func = func&#125;) <span class="comment">-- Create Listener.</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:DelListener</span><span class="params">(type, obj, func)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">not</span> self.listenerListMap[<span class="built_in">type</span>]) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">local</span> listenerList = self.listenerListMap[<span class="built_in">type</span>]</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> n=#listenerList, <span class="number">1</span>, <span class="number">-1</span> <span class="keyword">do</span></div><div class="line">		<span class="keyword">if</span> (listenerList[n].func == func <span class="keyword">and</span> listenerList[n].obj == obj) <span class="keyword">then</span></div><div class="line">			<span class="built_in">table</span>.remove(listenerList, n)</div><div class="line">			</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="keyword">false</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Caller:Call</span><span class="params">(type, ...)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">not</span> self.listenerListMap[<span class="built_in">type</span>]) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span></div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">local</span> listenerList = self.listenerListMap[<span class="built_in">type</span>]</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> n=#listenerList, <span class="number">1</span>, <span class="number">-1</span> <span class="keyword">do</span></div><div class="line">		listenerList[n].func(listenerList[n].obj, ...)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> Caller</div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　以上内容仅为提供一个思路，它或许并非最完善的，也不一定能适用于所有编程语言中，对此有所心得者，欢迎前来探讨，提供更佳的思路。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/04/19/event_mechanism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/19/event_mechanism/" itemprop="url">
                  浅谈对象之间通信的解决方案——Event机制
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-19T12:22:48+08:00">
                2017-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ProgramDesign/" itemprop="url" rel="index">
                    <span itemprop="name">ProgramDesign</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/19/event_mechanism/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/19/event_mechanism/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/19/event_mechanism/" class="leancloud_visitors" data-flag-title="浅谈对象之间通信的解决方案——Event机制">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong>      </p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　在程序设计的时候，不同对象与模块间总是不可避免会发生相互调用的情况，如果选择将对象互相作为参数传入给对方使用，那么这种现象一般被称为<strong>耦合</strong>，这样实际上就让两个部分连在了一块。当然这样子实际上并没有什么问题，只要这符合你的设计预期。只是一旦开发规模增大、开发人员增多、耦合程度加剧的话，程序的维护成本也便会随之剧增。往往会出现某个模块在另一个模块处被做了一些修改而不自知，以及在脚本语言的情况下，没有private保护的对象到了他处等同彻底的暴露，随便的修改的话，封装性也随之不存。那么由此看来，必须拥有一套对象之间通信的解决方案了，本文便是提供了一种思路供给参考。<br>　　以下代码演示将使用Lua语言，接下来的内容对阅读者的Lua水平有一定的要求。如果你不知道在Lua中class的实现方式，可参考<a href="http://blog.codingnow.com/2006/06/oo_lua.html" target="_blank" rel="external">这篇文章</a>。</p>
<h2 id="使用机制之前的做法"><a href="#使用机制之前的做法" class="headerlink" title="使用机制之前的做法"></a>使用机制之前的做法</h2><p>　　首先我们演示一下不用Event机制之前的做法，也就是一般人会用的做法。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- A.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> A = Class()</div><div class="line"><span class="keyword">local</span> B = <span class="built_in">require</span>(<span class="string">"b"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:Ctor</span><span class="params">()</span></span></div><div class="line">	self.value = <span class="number">1</span></div><div class="line">	self.b = B.New(self)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> A</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- B.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> B = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Ctor</span><span class="params">(a)</span></span></div><div class="line">	self.a = a</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Print</span><span class="params">()</span></span></div><div class="line">	<span class="built_in">print</span>(self.a.value)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> B</div></pre></td></tr></table></figure>
<h2 id="使用机制之后的做法"><a href="#使用机制之后的做法" class="headerlink" title="使用机制之后的做法"></a>使用机制之后的做法</h2><p>　　由上可以看出，这种直传对象的做法其实是十分危险的，它很容易破坏封装性，并且会达到「你中有我，我中有你」的效果，并且这还是在上下级的情况下。接下来便演示下使用了Event机制后的做法。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- A.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> A = Class()</div><div class="line"><span class="keyword">local</span> B = <span class="built_in">require</span>(<span class="string">"b"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:Ctor</span><span class="params">()</span></span></div><div class="line">	self.value = <span class="number">1</span></div><div class="line">	self.event = <span class="function"><span class="keyword">function</span><span class="params">(self, ...)</span></span> self:OnEvent(...) <span class="keyword">end</span></div><div class="line">	self.b = B.New(self.event)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:OnEvent</span><span class="params">(type, ...)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="built_in">type</span> == <span class="string">"GetValue"</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> self.value</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="string">"No Event"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> A</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- B.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> B = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Ctor</span><span class="params">(upperEvent)</span></span></div><div class="line">	self.upperEvent = upperEvent</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Print</span><span class="params">()</span></span></div><div class="line">	<span class="built_in">print</span>(self.upperEvent(<span class="string">"GetValue"</span>))</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> B</div></pre></td></tr></table></figure>
<p>　　通过对比可以看出，使用了Event机制后，不仅保证了封装性，而且还隔离了A对象的实现，换句话说，B对象的upperEvent已经不仅限于A了，只要是提供了一致的Event接口即可，并且A对象还能清除的知道自己对外究竟提供了什么接口，可维护性也随之提高了。<br>　　当然代价还是有的，那便是调用Event时的函数调用次数比传统方式有所增加，但我认为这是值得的。当然这只是一种思路，也未尝不可优化。</p>
<h2 id="疑难解答"><a href="#疑难解答" class="headerlink" title="疑难解答"></a>疑难解答</h2><p>　　问：关于两个平级对象需要相互调用要怎么做？<br>　　答：参考以下例子：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- A.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> A = Class()</div><div class="line"><span class="keyword">local</span> B = <span class="built_in">require</span>(<span class="string">"b"</span>)</div><div class="line"><span class="keyword">local</span> C = <span class="built_in">require</span>(<span class="string">"c"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:Ctor</span><span class="params">()</span></span></div><div class="line">	self.value = <span class="number">1</span></div><div class="line">	self.event = <span class="function"><span class="keyword">function</span><span class="params">(self, ...)</span></span> self:OnEvent(...) <span class="keyword">end</span></div><div class="line">	self.b = B.New(self.event)</div><div class="line">	self.c = C.New(self.event)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">A:OnEvent</span><span class="params">(type, ...)</span></span></div><div class="line">	<span class="keyword">if</span> (<span class="built_in">type</span> == <span class="string">"GetValue"</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> self.b:GetValue()</div><div class="line">	<span class="keyword">elseif</span> (<span class="built_in">type</span> == <span class="string">"SetTag"</span>) <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> self.c:SetValue(...)</div><div class="line">	<span class="keyword">end</span></div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="string">"No Event"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> A</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- B.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> B = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:Ctor</span><span class="params">(upperEvent)</span></span></div><div class="line">	self.upperEvent = upperEvent</div><div class="line">	self.value = <span class="number">1</span></div><div class="line"></div><div class="line">	self.upperEvent(<span class="string">"SetTag"</span>, <span class="string">"123"</span>)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">B:GetValue</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">return</span> self.value</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> B</div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- C.lua</span></div><div class="line"></div><div class="line"><span class="keyword">local</span> Class = <span class="built_in">require</span>(<span class="string">"class"</span>)</div><div class="line"><span class="keyword">local</span> C = Class()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">C:Ctor</span><span class="params">(upperEvent)</span></span></div><div class="line">	self.upperEvent = upperEvent</div><div class="line">	self.tag = <span class="string">""</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">C:SetTag</span><span class="params">(tag)</span></span></div><div class="line">	self.tag = tag</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">C:Print</span><span class="params">()</span></span></div><div class="line">	<span class="built_in">print</span>(self.upperEvent(<span class="string">"GetValue"</span>))</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> C</div></pre></td></tr></table></figure>
<p>　　由此可见，平级对象的相互调用，只需要统一由上级管理好需要调用的接口，然后平级对象从上级Event中获取即可。</p>
<p>　　问：一个对象可以拥有多个OnEvent()么？也就是针对不同对象派出不同的Event。<br>　　答：一般来说不推荐这么做，因为这只会使得维护成本提升。当然你很清楚自己的需求以及这么做的代价的话，但试无妨。</p>
<p>　　问：使用Event机制后有效的保证了封装性，但是对于上级管理下级的时候并不存在这种封装性的保护，那么该怎么办呢？<br>　　答：这个在脚本语言里是一个没办法的事，原则上最好是不要对外直接暴露变量，只使用函数。哪怕这会带来更高的性能代价，对于维护性而言也是值得的，当然这个问题或许也可以通过特殊的手段解决（参考Lua元表的内容）。</p>
<p>　　问：是不是严格意义所有情况下都不应该直传对象而采用Event呢？<br>　　答：这样显然是不现实的，比如某些类的业务本身就需要获取到对象本身（如容器），以及Event本身也是有性能代价以及构建成本的，不可能面面俱到。在某些你认为必要且可掌控的情况下，直传对象也并非不可以。毕竟解耦的目的也是为了提高可维护性，只要你觉得这样做是可以接受的，那么便可以了。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　以上内容仅为提供一个思路，它或许并非最完善的，也不一定能适用于所有编程语言中，对此有所心得者，欢迎前来探讨，提供更佳的思路。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/03/29/brew_changing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/brew_changing/" itemprop="url">
                  更换Homebrew的更新源
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T17:31:46+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teach/" itemprop="url" rel="index">
                    <span itemprop="name">Teach</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/29/brew_changing/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/29/brew_changing/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/29/brew_changing/" class="leancloud_visitors" data-flag-title="更换Homebrew的更新源">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　更换Homebrew的更新源的教程，在网上数不胜数，然内容大多大同小异且述之不详，且未提及版本上的差异。故作此文，以正视听。<br>　　在阅读此文之前，你需要了解<a href="https://brew.sh" target="_blank" rel="external">Homebrew</a>和<a href="https://git-scm.com" target="_blank" rel="external">Git</a>并安装了它们。并且对于Homebrew官方更新源的速度赶到不满且不打算利用其它手段解决（如VPN），或者看了其它文章感到不求甚解，那么此文对你而言是有价值的。</p>
<h2 id="更新源的机制"><a href="#更新源的机制" class="headerlink" title="更新源的机制"></a>更新源的机制</h2><p>　　Homebrew的更新源由三部分组成：本体（brew.git）、核心（homebrew-core.git）以及二进制预编译包（homebrew-bottles）。<br>　　在很多教程中，只会提及到更换本体，而未涉及到核心与二进制预编译包的更换。这样实际上效果是不完全的（尽管这样也无法做到完全，毕竟有一些软件包的地址是不被收录的，只能从它们提供的链接处下载）。<br>　　从.git的后缀名可以看出，Homebrew的更新源是以Git仓库的形式存在的，这便是为什么需要用到Git的原因。也正是如此，使得可以对其进行克隆，成为新源。  </p>
<h2 id="更新源的选择"><a href="#更新源的选择" class="headerlink" title="更新源的选择"></a>更新源的选择</h2><p>　　默认官方的更新源都是存放在<a href="https://github.com" target="_blank" rel="external">GitHub</a>上的，这也是中国大陆用户访问缓慢的原因，一般来说我们会更倾向选择国内提供的更新源，在此推荐<a href="https://mirrors.ustc.edu.cn/" target="_blank" rel="external">中国科大</a>以及<a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="external">清华大学</a>提供的更新源，因为它们能够完整以上源组成的三个部分。并且在此感谢他们为大家提供的服务。
　　</p>
<h2 id="替换更新源"><a href="#替换更新源" class="headerlink" title="替换更新源"></a>替换更新源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 替换brew.git:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></div><div class="line"><span class="comment"># 中国科大:</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/brew.git</div><div class="line"><span class="comment"># 清华大学:</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</div><div class="line"></div><div class="line"><span class="comment"># 替换homebrew-core.git:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></div><div class="line"><span class="comment"># 中国科大:</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</div><div class="line"><span class="comment"># 清华大学:</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</div><div class="line"></div><div class="line"><span class="comment"># 替换homebrew-bottles:</span></div><div class="line"><span class="comment"># 中国科大:</span></div><div class="line">$ <span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.bash_profile</div><div class="line">$ <span class="built_in">source</span> ~/.bash_profile</div><div class="line"><span class="comment"># 清华大学:</span></div><div class="line">$ <span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.bash_profile</div><div class="line">$ <span class="built_in">source</span> ~/.bash_profile</div><div class="line"></div><div class="line"><span class="comment"># 应用生效:</span></div><div class="line">$ brew update</div></pre></td></tr></table></figure>
<p>　　以上在中国科大和清华大学任选其一即可，在使用其他源的时候，最好先尝试访问其链接看看是否健在，并且因为历史原因，最初的brew.git是叫homebrew.git的，而现在部分更新源早已随官方更名，所以切记要验证。<br>　　并且没有严格规定必须三个组成部分必须是来自同一提供，可随性发挥。<br>　　且Homebrew在早期版本中更新源的是在/usr/local目录下的，而现在是在/usr/local/Homebrew，不过应该都是可以使用<code>&quot;$(brew --repo)&quot;</code>来自动指向目录的，所以无需理会。<br>　　如果你之前折腾过不少导致你的Homebrew有点问题，那么可以尝试使用如下方案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 诊断Homebrew的问题:</span></div><div class="line">$ brew doctor</div><div class="line"></div><div class="line"><span class="comment"># 重置brew.git设置:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></div><div class="line">$ git fetch</div><div class="line">$ git reset --hard origin/master</div><div class="line"></div><div class="line"><span class="comment"># homebrew-core.git同理:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></div><div class="line">$ git fetch</div><div class="line">$ git reset --hard origin/master</div><div class="line"></div><div class="line"><span class="comment"># 应用生效:</span></div><div class="line">$ brew update</div></pre></td></tr></table></figure>
<h2 id="重置更新源"><a href="#重置更新源" class="headerlink" title="重置更新源"></a>重置更新源</h2><p>　　所谓有进则有退，在某些时候也有换回官方源的需求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 重置brew.git:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://github.com/Homebrew/brew.git</div><div class="line"></div><div class="line"><span class="comment"># 重置homebrew-core.git:</span></div><div class="line">$ <span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></div><div class="line">$ git remote <span class="built_in">set</span>-url origin https://github.com/Homebrew/homebrew-core.git</div></pre></td></tr></table></figure>
<p>　　至于homebrew-bottles，本质上作为一个环境变量的存在，之前的命令也只是将其写入到<code>/usr/.bash_profile</code>中，并且只是在文件尾部添加一行。所以之前的命令不推荐重复执行，在未掌握相关命令技巧的前提下，我推荐直接去修改<code>.bash_profile</code>文件：<img src="https://musoucrow.github.io/images/brew_changing/bash_profile.png" alt="bash_profile"><br>　　当然这里的主题是重置更新源，所以我们直接选择删除环境变量HOMEBREW_BOTTLE_DOMAIN，使其成为默认值即可。<br>　　当然，最后不要忘记<code>$ brew update</code>进行应用。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>　　在完成更新源的更换后，我们可以使用<code>$ brew upgrade</code>将现有的软件进行更新至最新版本，这样便能很直接的看出速度上的变化了。最后不要忘记<code>$ brew cleanup</code>将旧有的软件安装包进行清理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/03/03/research_awesomenauts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/03/research_awesomenauts/" itemprop="url">
                  王牌英雄(Awesomenauts)研究报告
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-03T20:13:40+08:00">
                2017-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Research/" itemprop="url" rel="index">
                    <span itemprop="name">Research</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/03/research_awesomenauts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/03/research_awesomenauts/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/03/research_awesomenauts/" class="leancloud_visitors" data-flag-title="王牌英雄(Awesomenauts)研究报告">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　出于项目的需要，需要对市面上的<strong>横版MOBA动作游戏</strong>进行研究，特撰此文，以便记录和交流。本文将对《王牌英雄》分为几个部分进行研究并以章节的形式体现，文中观点仅为本人一家之言，仅供参考。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>　　《王牌英雄》是一款由Ronimo Games制作，DTP Entertainment发行于2012年的2D横版动作游戏。游戏平台繁多，包括Windows、macOS、Linux、PS3、PS4、Xbox360、Xbox One。玩家可于Steam、PSN和XBLA进行购买下载。<br>　　游戏虽然是2D横版动作游戏，但其实他更讲究玩家间的对抗，属于MOBA游戏，而且武器、职业和招式的种类也繁多非常值得多人一起游戏。<br>　　《王牌英雄》主要讲述了星系间的领土争夺战争，巨型机器人、外星人等都会成为出战角色。<br>　　与众多的MOBA游戏类似，《王牌英雄》也是以与队友（<strong>3V3</strong>）合作，摧毁敌方的基地为胜利目标。一场游戏的时间大致在<strong>10-15分钟</strong>，拥有PVE/PVP两种模式，可进行各种设置以增添游戏特色。</p>
<h2 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><p>　　地图分为上下两路，需要利用跳跃到踏板上进行Y轴移动。拥有多张地图，但皆大同小异。总体结构如下图：<img src="http://vignette1.wikia.nocookie.net/awesomenauts/images/4/4b/Ribbit_IV.jpg" alt="Ribbit_IV"></p>
<h3 id="要素"><a href="#要素" class="headerlink" title="要素"></a>要素</h3><ul>
<li>商店<ul>
<li>商店是英雄支付太阳能以强化技能的地方，并提供了恢复功能。</li>
<li>商店属于阵营设施，位于阵营的最深处，可视为传统MOBA的泉水。</li>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/shop.png" alt="shop"></li>
</ul>
</li>
<li>基地<ul>
<li>基地属于阵营设施，可摧毁，位于商店之前，是阵营的核心，若基地被摧毁，则视为游戏失败。</li>
<li>基地不会攻击，不会自我恢复，敌人不可通过。</li>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/main_tower.png" alt="main_tower"></li>
</ul>
</li>
<li>屏障<ul>
<li>屏障属于阵营设施，位于地图各处，敌人不可通过。</li>
<li><img src="http://vignette4.wikia.nocookie.net/awesomenauts/images/b/b3/Energy_Wall.jpg" alt="Energy_Wall"></li>
</ul>
</li>
<li>工厂<ul>
<li>工厂属于阵营设施，位于基地下方，负责生成士兵。</li>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/factory.png" alt="factory"></li>
</ul>
</li>
<li>塔<ul>
<li>塔属于阵营设施，可摧毁，位于上下二路，每路各有两座。</li>
<li>负责攻击附近的敌人，敌人不可通过。</li>
<li>攻击方式为多角度子弹，且只会锁定并伤害一个单位（单一伤害）。</li>
<li>在建筑本身还有一个群体伤害判定，强行通过时会触发。</li>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/tower.png" alt="tower"></li>
</ul>
</li>
<li>士兵<ul>
<li>士兵属于阵营单位，可摧毁，敌人不可通过（会将士兵推后），从工厂诞生，前往上下二路。（前往上路需要跳跃/飞行等方式）目标为攻击敌人，拥有两种类型。</li>
<li>士兵分为三个等级，每隔<strong>6分钟</strong>升级一次。升级后士兵的属性将会得到提升。（用于推进游戏节奏）</li>
<li>种类<ul>
<li>近战兵<ul>
<li>最基础的种类，每隔20秒诞生2个。</li>
<li>攻击方式为齿轮切割，属于单一伤害。和塔一样，强行通过时会被连带攻击。</li>
<li><img src="http://vignette3.wikia.nocookie.net/awesomenauts/images/e/e1/Sawblade_Droid.png" alt="Sawblade_Droid"></li>
</ul>
</li>
<li>超级兵<ul>
<li>当摧毁敌方线上的1座塔后，便会诞生1个。</li>
<li>攻击方式为发射炮弹，碰到第一个敌人后爆炸，属于群体伤害。</li>
<li><img src="http://vignette1.wikia.nocookie.net/awesomenauts/images/5/54/Super_Droid.png" alt="Super_Droid"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>英雄<ul>
<li>英雄属于阵营单位，可摧毁，敌人不可通过，从基地诞生，由玩家控制。</li>
<li>英雄死亡后隔一段时间后便会从基地复活，随着游戏时间的增长，复活时间也会增长。</li>
</ul>
</li>
<li>野怪<ul>
<li>野怪属于公共单位，可摧毁，位于地图中间的几个固定点，目标为攻击进犯者，在不同地图上拥有不同类型，每隔一段时间刷新。</li>
<li>英雄可通过击杀之获得太阳能和恢复。</li>
<li><img src="http://vignette3.wikia.nocookie.net/awesomenauts/images/0/0b/Small_Beast_Creep.png" alt="Small_Beast_Creep"></li>
</ul>
</li>
<li>踏板<ul>
<li>踏板属于公共设施，位于地图各处，可供单位立足，且玩家可通过↓+Space穿透踏板进行下降。</li>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/pad.png" alt="pad"></li>
</ul>
</li>
<li>隐藏区域<ul>
<li>隐藏区域属于公共设施，位于地图各处，一般会搭配踏板使用，外界无法看到隐藏区域里面的情况。</li>
<li><img src="http://vignette4.wikia.nocookie.net/awesomenauts/images/e/e7/Hidearea.png" alt="Hidearea"></li>
</ul>
</li>
<li>补给球<ul>
<li>补给球属于公共设施，位于地图各处，受伤时的英雄触碰后可恢复，然后补给球消失，每隔一段时间刷新。</li>
<li><img src="http://vignette2.wikia.nocookie.net/awesomenauts/images/3/3a/Healthpack.png" alt="Healthpack"></li>
</ul>
</li>
<li>太阳能结晶<ul>
<li>太阳能结晶属于公共设施，位于地图各处，诞生自士兵死亡后，英雄触碰后可获得太阳能。</li>
<li>太阳能分为两种：灰色和黄色，灰色可获得1点太阳能，黄色为5点。</li>
<li><img src="http://vignette1.wikia.nocookie.net/awesomenauts/images/2/29/Item_5_solar.png" alt="solar"></li>
</ul>
</li>
</ul>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>　　总体来说，《王牌英雄》的地图设计视图让玩家频繁的使用跳跃，利用踏板借助跳跃来增加游戏的操作性，弥补非深度横版的躲招问题。意图不错，不过反倒增加了操作难度，若要考虑移植到手机平台的话，这将是个问题。<br>　　地图中间的野怪设计，可以视为玩家发生冲突时随手杀死野怪以获得恢复的手段。不过结合游戏时间来看，野区其实可以设计一些加剧玩家冲突与游戏节奏的元素。<br>　　士兵的作用非常明显，在英雄单独对抗士兵时，会付出一定程度的代价。不过超级兵的诞生频率太低，几乎没有存在感，作用也相对有限了。</p>
<h2 id="英雄"><a href="#英雄" class="headerlink" title="英雄"></a>英雄</h2><h3 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h3><p>　　英雄即玩家参与游戏时扮演的角色，《王牌英雄》的英雄数量繁多，至今发展到几十个左右。</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p>　　《王牌英雄》将英雄做了不同特性的划分，每个英雄可能包括多个特性，以下是特性一览：</p>
<ul>
<li>刺客<ul>
<li>入门角色</li>
<li>Gank好手</li>
<li>低生命值</li>
<li>高机动性</li>
<li>拥有爆发或高持续的伤害</li>
<li>拥有逃跑手段</li>
</ul>
</li>
<li>斗士<ul>
<li>堵路机制</li>
<li>追逐好手</li>
<li>擅长近距离战斗</li>
<li>拥有控制手段</li>
<li>拥有高持续的伤害</li>
</ul>
</li>
<li>护卫<ul>
<li>能有效地防御来自敌方的攻击</li>
<li>能力都集中在撤退和阻挠进攻的方法，而非直接作战。</li>
</ul>
</li>
<li>狙击手<ul>
<li>长距离攻击，短冷却时间</li>
<li>善于放风筝</li>
<li>不善于近战</li>
<li>有加速手段</li>
</ul>
</li>
<li>开团手<ul>
<li>擅长打团，不擅长独战</li>
<li>拥有高风险高回报的特性</li>
<li>拥有非常强大的控制手段</li>
</ul>
</li>
<li>医师<ul>
<li>有限的攻击力</li>
<li>无逃生手段</li>
<li>需要被保护</li>
<li>拥有治疗能力</li>
</ul>
</li>
<li>毒师<ul>
<li>拆塔好手</li>
<li>拥有能够立即杀死多个目标的能力，通常冷却时间较短</li>
</ul>
</li>
<li>辅助<ul>
<li>不适合直接战斗</li>
<li>万金油</li>
<li>需要被保护</li>
<li>拥有改变团队的能力</li>
</ul>
</li>
<li>坦克<ul>
<li>高生命值</li>
<li>减伤好手</li>
<li>适合打头阵</li>
<li>不善于追逐</li>
</ul>
</li>
</ul>
<h3 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h3><p>　　在《王牌英雄》，每个英雄拥有四个技能，它们分别是：<strong>主动技能1、主动技能2、普通攻击、跳跃</strong>。我们接下来便以<em>谢里夫·龙星</em>为示范：</p>
<ul>
<li>主动技能1<ul>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/skill1.png" alt="skill1"></li>
</ul>
</li>
<li>主动技能2<ul>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/skill2.png" alt="skill2"></li>
</ul>
</li>
<li>普通攻击<ul>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/normalatk.png" alt="normalatk"></li>
</ul>
</li>
<li>跳跃<ul>
<li><img src="https://musoucrow.github.io/images/research_awesomenauts/jump.png" alt="jump"></li>
</ul>
</li>
</ul>
<p>　　技能还可以在商店支付太阳能进行强化，如下图：<img src="https://musoucrow.github.io/images/research_awesomenauts/skillup.png" alt="skillup"></p>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>　　在《王牌英雄》，属性和一般游戏不同：它明确分为<strong>自身属性和技能属性</strong>。自身属性即单位本身常驻的属性，而技能属性则为描述技能作用的参数。<br>　　自身属性一般来说都是隐藏的，每个英雄的自身属性都是事先决定，这意味着这并不是一款需要属性养成的游戏，你并不需要太关注属性方面的事情，但你仍可在商店里进行一些强化。<br>　　以下是属性一览：</p>
<ul>
<li>自身属性<ul>
<li>生命值<ul>
<li>生命值是指死亡前可以采取的伤害量。换言之，到了0就会死。</li>
</ul>
</li>
<li>质量<ul>
<li>质量是指单元推动或被另一单元推动的能力，例如近战兵的质量就很低（可以被推后）。</li>
</ul>
</li>
<li>移动速度<ul>
<li>移动速度即单位移动时的速度。</li>
</ul>
</li>
<li>太阳能获取<ul>
<li>每段时间获取太阳能的数额。</li>
</ul>
</li>
<li>太阳能<ul>
<li>用于商店购买强化技能。</li>
</ul>
</li>
</ul>
</li>
<li>技能属性<ul>
<li>攻击速度<ul>
<li>攻击速度决定每次攻击之间的时间间隔，一般存在于普通攻击。</li>
<li>攻击速度以一个数值的形式体现，结算到具体的时间需要/60。</li>
</ul>
</li>
<li>攻击范围<ul>
<li>攻击范围指子弹的行进距离。</li>
<li>攻击范围对非发射子弹类技能无效。</li>
</ul>
</li>
<li>技能范围<ul>
<li>俗称AOE，泛指那些覆盖一个区域的技能效果。</li>
</ul>
</li>
<li>冷却时间<ul>
<li>冷却时间是指技能可以再次使用之前必须经过的时间段。</li>
<li>每个技能都有自己的冷却时间，普通攻击和跳跃不存在冷却时间。</li>
</ul>
</li>
<li>控制时间<ul>
<li>控制时间是指使敌方停止/阻碍行动的时间段。</li>
<li>控制的表现手法多样。</li>
</ul>
</li>
<li>持续伤害<ul>
<li>俗称DOT，泛指随时间慢慢伤害目标的效果。</li>
</ul>
</li>
<li>飞行<ul>
<li>飞行是无限跳跃或能够永远留在空中的能力。</li>
</ul>
</li>
<li>治疗<ul>
<li>治疗是指恢复目标生命值的能力。</li>
</ul>
</li>
<li>隐形<ul>
<li>隐形是使目标完全不可见的状态效应。当隐形的单位使用能力或自动攻击时，或者在一段时间后，隐形会消失。</li>
</ul>
</li>
<li>生命偷取<ul>
<li>生命偷取是一种特殊的伤害，它在击中敌人后生效。</li>
<li>生命偷取可以是基于百分比或固定量。</li>
</ul>
</li>
<li>护盾<ul>
<li>护盾是给予英雄保护的能力，在存在护盾时，受到攻击后会优先磨损护盾。</li>
</ul>
</li>
<li>反射<ul>
<li>反射是一种使敌人子弹反射回攻击者的机制。同时因为反射了，所以英雄不会受伤。</li>
</ul>
</li>
<li>加速<ul>
<li>一段时间内获得移动速度。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="后记-1"><a href="#后记-1" class="headerlink" title="后记"></a>后记</h3><p>　　《王牌英雄》英雄的特性分类值得思考，技能属性的设计更是优秀，运用这种思路，制作技能将会简单很多。<br>　　但是在技能设计和人设方面就不太合我胃口，尤其是技能方面，由于技能数量和深度不足的原因便显得比较单调，就算拥有强化途径但也感觉稍逊一筹，也许在这方面应该可以做得更好。</p>
<h2 id="战斗"><a href="#战斗" class="headerlink" title="战斗"></a>战斗</h2><h3 id="前言-3"><a href="#前言-3" class="headerlink" title="前言"></a>前言</h3><p>　　《王牌英雄》在战斗上拥有不少细节值得研究，而有些东西不方便插入到其他章节中，便集中到本章讨论。</p>
<h3 id="攻击类型"><a href="#攻击类型" class="headerlink" title="攻击类型"></a>攻击类型</h3><p>　　《王牌英雄》的攻击方式分为两种：单一攻击和群体攻击。单一攻击表现为击中一个敌人后便会结束，忽略其他敌人。而群体攻击则不然，会攻击范围内所有敌人。</p>
<h3 id="打击特征"><a href="#打击特征" class="headerlink" title="打击特征"></a>打击特征</h3><p>　　《王牌英雄》属于轻动作游戏，它不是那种击中敌人后敌人便会陷入硬直，以连招为乐的动作游戏。它似乎连硬直和浮空动作也不具备，尽管会有类似的效果表现。就连打击特效，也仅仅是近战角色才有。平常的打击特征为被击者出现黄色遮罩，以及配合伤害数字来确定被击中，更别提Hit Stop了。因此使得《王牌英雄》的动作性并不高，它主要以不断跳跃位置的游击战为特色。<br>　　幸运的是，《王牌英雄》还是具备了基本的战斗音效，所以总体来说还是不成问题的，只是缺乏了点动作性而已。</p>
<h3 id="BUFF"><a href="#BUFF" class="headerlink" title="BUFF"></a>BUFF</h3><p>　　《王牌英雄》虽然存在BUFF系统，但并没有展示BUFF的UI，只存在BUFF特效和触发提示，如图：<img src="https://musoucrow.github.io/images/research_awesomenauts/debuff.png" alt="skillup"></p>
<h3 id="障碍"><a href="#障碍" class="headerlink" title="障碍"></a>障碍</h3><p>　　《王牌英雄》的障碍形式区域制，只要单位能过跨越障碍就能通过，如通过跳跃穿过敌方士兵，但若同时撞上在空中的地方英雄则会无法继续前行，被迫降落。<br>　　至于降落点本身就有障碍该如何处理，这一点<strong>尚不明确</strong>。</p>
<h3 id="后记-2"><a href="#后记-2" class="headerlink" title="后记"></a>后记</h3><p>　　《王牌英雄》的战斗系统在我看来并不讨喜，主要原因为总体攻击距离太短，加上依赖跳跃的地形，使得直接触发战斗的成本提高，当然好这口的人估计会很喜欢。<br>　　能够在跳跃中使用大部分技能的设计还是很不错的，给人一种空战的感觉。类似的设计还有多角度攻击，不过这个是远程英雄的专利，对于近战英雄并不友好，我认为这个设计已经影响到了平衡性，因为本身能够快速接近敌人手段并不多。</p>
<h2 id="后记-3"><a href="#后记-3" class="headerlink" title="后记"></a>后记</h2><p>　　《王牌英雄》从游戏的角度上让我评分的话，10分里面只能打个4分：它不是我的菜，无论从战斗、技能、还是人设来看，都是如此。<br>　　但它对我而言的意义在于：提供了一款横版MOBA动作游戏的示范，它还是一款成熟的横版MOBA模型，使我得到了不少启发，也使我明白哪些部分应该加以改善。本次《王牌英雄》的研究报告，就此结束。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://musoucrow.github.io/2017/02/26/build_bolg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Musoucrow">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Musoucrow' BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/26/build_bolg/" itemprop="url">
                  在Mac平台使用GitHub和Hexo搭建博客
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T06:01:28+08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Teach/" itemprop="url" rel="index">
                    <span itemprop="name">Teach</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/26/build_bolg/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/26/build_bolg/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/02/26/build_bolg/" class="leancloud_visitors" data-flag-title="在Mac平台使用GitHub和Hexo搭建博客">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　<strong>欢迎参与讨论，转载请注明出处。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　在整这个博客时遇到了不少坑，正适合作为此博客的第一篇正文。另外本文会随博客的调整而更新，可保持关注。<br>　　本次的博客搭建平台为<strong>Mac OS X 11.6</strong>，但总体来说用到系统本身特性的地方很少，所以其他系统的使用者亦可参考。<br>　　本文涉及到一些软件的相关知识，如果你不了解它们，请先去了解一番。<br>　　如果你已是<a href="https://github.com/" target="_blank" rel="external">GitHub</a>用户并且创建了<a href="https://pages.github.com/" target="_blank" rel="external">GitHub Pages</a>仓库，你可以跳过<em>部署GitHub</em>。<br>　　如果你已安装<a href="https://git-scm.com/" target="_blank" rel="external">Git</a>、<a href="https://www.npmjs.com/" target="_blank" rel="external">NPM</a>和<a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a>，或<strong>非Mac OS平台</strong>，你可以跳过<em>安装前置软件</em>，但非Mac OS平台的用户请自行解决前置软件的问题。</p>
<h2 id="部署GitHub"><a href="#部署GitHub" class="headerlink" title="部署GitHub"></a>部署GitHub</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><p>　　本次博客的发布网站是隶属于GitHub的GitHub Pages仓库，通过把网站文件存放到这种仓库里，你便可以利用GitHub提供给你的外链访问它。<br>　　声明：以下部分内容转载自铁锚的<a href="http://blog.csdn.net/renfufei/article/details/37725057/" target="_blank" rel="external">创建GitHub技术博客全攻略</a>。</p>
<h3 id="注册账号"><a href="#注册账号" class="headerlink" title="注册账号"></a>注册账号</h3><p>　　前往<a href="https://github.com/" target="_blank" rel="external">GitHub</a>官网，参考下图输入账号、邮箱、密码，然后点击注册按钮。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/register.png" alt="register"></p>
<h3 id="初始设置"><a href="#初始设置" class="headerlink" title="初始设置"></a>初始设置</h3><p>　　注册完成后，选择Free免费账号完成设置。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/welcome.png" alt="welcome.png"></p>
<h3 id="验证邮箱"><a href="#验证邮箱" class="headerlink" title="验证邮箱"></a>验证邮箱</h3><p>　　请打开你的邮箱，查看发送给你的确认邮件。你需要验证邮箱后，后面生成的个人主页才会被接受和发布。</p>
<h3 id="创建页面仓库"><a href="#创建页面仓库" class="headerlink" title="创建页面仓库"></a>创建页面仓库</h3><p>　　前往<a href="https://github.com/new" target="_blank" rel="external">创建仓库</a>，参考下图。<br>　　仓库的名字需要和你的账号对应， 如 <em>tiemaocsdn.github.io</em>。<br>　　输入基本信息，然后点击创建仓库。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/newrep.png" alt="newrep"></p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>　　当你创建完页面仓库后，此时你的个人页面<em><a href="https://username.github.io/" target="_blank" rel="external">https://username.github.io/</a></em>已经创建完成（username即你的GitHub用户名，下同），虽然还是空无一物，不过你已可以进行下一步了。  </p>
<h2 id="安装前置软件"><a href="#安装前置软件" class="headerlink" title="安装前置软件"></a>安装前置软件</h2><h3 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h3><p>　　在进行安装核心软件之前，你需要先准备好其所依赖的软件。包括<a href="https://git-scm.com/" target="_blank" rel="external">Git</a>、<a href="https://www.npmjs.com/" target="_blank" rel="external">NPM</a>和<a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a>。  </p>
<h3 id="安装Homebrew"><a href="#安装Homebrew" class="headerlink" title="安装Homebrew"></a>安装Homebrew</h3><p>　　在Mac OS下，你可以选择通过<a href="https://brew.sh/" target="_blank" rel="external">Homebrew</a>来进行许多服务类软件的安装（这样会方便很多），在其他系统下也有类似的替代方案。<br>　　打开终端, 输入以下脚本。  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/ruby <span class="_">-e</span> <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></div></pre></td></tr></table></figure>
<p>　　等待安装完成后，在终端输入<strong>brew</strong>进行调试，如无报错则可继续。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/brew.png" alt="brew"></p>
<h3 id="通过Homebrew安装其余软件"><a href="#通过Homebrew安装其余软件" class="headerlink" title="通过Homebrew安装其余软件"></a>通过Homebrew安装其余软件</h3><p>　　如果你不用Homebrew，那么请通过其他方式进行下载并安装（例如官网）。以下演示使用Homebrew安装他们，一样是通过终端输入，需要按照顺序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">brew install git</div><div class="line">brew install node</div><div class="line">brew install npm</div></pre></td></tr></table></figure>
<p>　　与Homebrew一样，安装完成后，你可以尝试依次在终端输入<strong>git</strong>、<strong>node</strong>、<strong>npm</strong>进行调试，如无报错则可继续。  </p>
<h3 id="后记-1"><a href="#后记-1" class="headerlink" title="后记"></a>后记</h3><p>　　如果你觉得Homebrew的速度很慢，那么你可以考虑选择<strong>更换镜像</strong>。请通过搜索引擎寻找相关资料。  </p>
<h2 id="安装Hexo及主题"><a href="#安装Hexo及主题" class="headerlink" title="安装Hexo及主题"></a>安装Hexo及主题</h2><h3 id="前言-3"><a href="#前言-3" class="headerlink" title="前言"></a>前言</h3><p>　　本次博客的框架源自<a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>，我们通过使用它来搭建出博客。Hexo基于Node.js，所以我们可以使用NPM来安装它，这在其他系统下也是一样的。  </p>
<h3 id="使用NPM安装"><a href="#使用NPM安装" class="headerlink" title="使用NPM安装"></a>使用NPM安装</h3><p>　　与之前一样，在终端输入以下内容（选择其中之一），你的网络如果不是很好的话，可以选择方案二（通过淘宝镜像进行下载）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install -g hexo-cli</div><div class="line">npm install -g hexo-cli --registry=https://registry.npm.taobao.org</div></pre></td></tr></table></figure>
<h3 id="新建博客工程"><a href="#新建博客工程" class="headerlink" title="新建博客工程"></a>新建博客工程</h3><p>　　接下来你需要在终端切换到你觉得合适的目录下通过Hexo新建你的博客工程（也可以不管，只要你知道当前终端目录的所在）。例如（目录可通过拖动文件夹到终端指定）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /Users/Username/Documents/Bolg</div><div class="line">hexo init</div></pre></td></tr></table></figure>
<p>　　经过一段时间后便会在Bolg文件夹下新建一堆文件，如下图这般，如无报错则可继续。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/path.png" alt="path"></p>
<h3 id="关于博客主题"><a href="#关于博客主题" class="headerlink" title="关于博客主题"></a>关于博客主题</h3><p>　　在你新建博客工程后仍需要选择一个<em>主题(theme)</em>应用到博客里，主题文件位于博客工程下的<strong>themes</strong>目录，默认便存在一款名为<em>landscape</em>的主题。你可以选择从Hexo官网的<a href="https://hexo.io/themes/" target="_blank" rel="external">主题专栏</a>下载其他主题。<br>　　以下便以本博客所使用的<a href="https://github.com/iissnan/hexo-theme-next/" target="_blank" rel="external">NexT</a>为范例进行演示。接下来的内容将会参考<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="external">这里</a>。</p>
<h3 id="安装NexT主题"><a href="#安装NexT主题" class="headerlink" title="安装NexT主题"></a>安装NexT主题</h3><p>　　前往<a href="https://github.com/iissnan/hexo-theme-next/releases" target="_blank" rel="external">发布页面</a>选择你想要的版本（下图0.4.0版仅为示范），下载解压后获得Next主题，然后将其以文件夹的形式放到themes目录下。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/download.png" alt="download">  </p>
<p>　　贴士：你可以考虑像我这样把解压后的文件夹名称更改为next，这样会更清晰。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/themes.png" alt="themes"></p>
<h3 id="后记-2"><a href="#后记-2" class="headerlink" title="后记"></a>后记</h3><p>　　关于主题的选择其实远不止官网所刊，关于这些方面的你可以多去寻觅甚至自己动手丰衣足食！</p>
<h2 id="部署博客"><a href="#部署博客" class="headerlink" title="部署博客"></a>部署博客</h2><h3 id="前言-4"><a href="#前言-4" class="headerlink" title="前言"></a>前言</h3><p>　　接下来我们要确立一个概念：在 Hexo 中有两份主要的配置文件，其名称都是 <em>_config.yml</em>。 其中，一份位于<strong>博客工程目录（根目录）</strong>下，主要包含 Hexo 本身的配置；另一份位于<strong>主题目录</strong>下，这份配置由主题作者提供，主要用于配置主题相关的选项。<br>　　为了描述方便，在以下说明中，将前者称为<strong>站点配置文件</strong>， 后者称为<strong>主题配置文件</strong>。  </p>
<h3 id="启用主题并调试"><a href="#启用主题并调试" class="headerlink" title="启用主题并调试"></a>启用主题并调试</h3><p>　　打开<strong>站点配置文件</strong>，找到<em>theme</em>字段，并将其值更改为<em>next</em>（主题文件夹名称）。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/change_theme.png" alt="change_theme"><br>　　到此，NexT 主题安装完成。下一步我们将验证主题是否正确启用。<br>　　首先打开终端并切换目录到博客工程，输入<code>hexo server --debug</code>进行网站调试。当命令行输出中提示出：<br>　　<code>INFO  Hexo is running at http://0.0.0.0:4000/. Press Ctrl+C to stop.</code><br>　　此时即可使用浏览器访问<code>http://localhost:4000</code>，检查站点是否正确运行。<br>　　当你看到站点的外观与下图所示类似时即说明你已成功安装 NexT 主题。这是 NexT 默认的 Scheme —— Muse。<br>　　<img src="https://musoucrow.github.io/images/build_bolg/muse.png" alt="muse"><br>　　现在，你已经成功安装并启用了 NexT 主题。你现在可以在终端按下Ctrl+C结束调试，下一步我们将要更改一些主题的设定，包括个性化以及集成第三方服务。</p>
<h3 id="个性化设置"><a href="#个性化设置" class="headerlink" title="个性化设置"></a>个性化设置</h3><p>　　打开<strong>站点配置文件</strong>，你可以修改以下字段来实现：  </p>
<ul>
<li><p>language  </p>
<ul>
<li>设置成你所需要的语言，例如：<em>language: zh-Hans</em></li>
<li>目前 NexT 支持的语言如以下表格所示：<img src="https://musoucrow.github.io/images/build_bolg/language.png" alt="language"></li>
</ul>
</li>
<li><p>avatar</p>
<ul>
<li>设置成头像的链接地址，例如：<em>avatar: <a href="http://example.com/avatar.png" target="_blank" rel="external">http://example.com/avatar.png</a></em></li>
<li>其中，头像的链接地址可以是：<img src="https://musoucrow.github.io/images/build_bolg/avatar.png" alt="avatar"></li>
</ul>
</li>
<li><p>author</p>
<ul>
<li><p>设置author为你的昵称，例如：<em>Musoucrow</em></p>
<p>打开<strong>主题配置文件</strong>，你可以修改以下字段来实现：</p>
</li>
</ul>
</li>
<li><p>scheme</p>
<ul>
<li>Scheme是NexT提供的一种特性，借助于Scheme，NexT为你提供多种不同的外观。同时，几乎所有的配置都可以 在Scheme之间共用。目前NexT支持三种Scheme，他们是：<ul>
<li>Muse - 默认 Scheme，这是 NexT 最初的版本，黑白主调，大量留白</li>
<li>Mist - Muse 的紧凑版本，整洁有序的单栏外观</li>
<li>Pisces - 双栏 Scheme，小家碧玉似的清新</li>
</ul>
</li>
<li>搜索scheme关键字。 你会看到有三行scheme的配置，将你需用启用的scheme前面注释<em>#</em>即可。<img src="https://musoucrow.github.io/images/build_bolg/scheme.png" alt="scheme"></li>
</ul>
</li>
<li><p>menu</p>
<ul>
<li>设定菜单内容，可通过解除几个自带项的注释<em>#</em>来开启栏目。</li>
<li>也可以自己进行新增，格式为<em>item name: link</em>。<ul>
<li>item name是一个名称，这个名称并不直接显示在页面上，它将用于匹配图标以及翻译。</li>
</ul>
</li>
<li>NexT 默认的菜单项有（标注！的项表示需要手动创建这个页面）：<img src="https://musoucrow.github.io/images/build_bolg/menu.png" alt="menu"> </li>
</ul>
</li>
<li><p>social</p>
<ul>
<li>social可让博客的侧栏里的角色介绍栏目下增加链接项（可添加多个），你可以这样设置：<img src="https://musoucrow.github.io/images/build_bolg/social1.png" alt="social1"> </li>
<li>博客的具体效果为：<img src="https://musoucrow.github.io/images/build_bolg/social2.png" alt="social2"> </li>
</ul>
</li>
</ul>
<h3 id="新建标签和分类栏目"><a href="#新建标签和分类栏目" class="headerlink" title="新建标签和分类栏目"></a>新建标签和分类栏目</h3><p>　　回到终端，仍然是博客工程目录下，依次输入以下两句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo new page tags</div><div class="line">hexo new page categories</div></pre></td></tr></table></figure>
<p>　　这样便创建好了标签和分类栏目的页面文件，但仍需要做一些处理。<br>　　打开<em>source/categories/index.md</em>和<em>source/tags/index.md</em>，分别修改成： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: categories</div><div class="line">date: 2017-02-25 21:43:34</div><div class="line">comments: false</div><div class="line">type: &quot;categories&quot;</div><div class="line">---</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: tags</div><div class="line">date: 2017-02-25 22:40:53</div><div class="line">comments: false</div><div class="line">type: &quot;tags&quot;</div><div class="line">---</div></pre></td></tr></table></figure>
<p>　　你现在可以再次调试一下看看效果，不出意外的话，已经实现了标签和分类栏目。记得要先结束之前的网站调试（在调试终端下按<strong>Ctrl+C</strong>），再重新进行。</p>
<h3 id="后记-3"><a href="#后记-3" class="headerlink" title="后记"></a>后记</h3><p>　　静态站点拥有一定的局限性，因此我们需要借助于第三方服务来扩展站点的功能。 以下是 NexT 目前支持的第三方服务，你可以根据你的需求集成一些功能进来。<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="external">详情查看</a></p>
<h2 id="发表帖子"><a href="#发表帖子" class="headerlink" title="发表帖子"></a>发表帖子</h2><h3 id="前言-5"><a href="#前言-5" class="headerlink" title="前言"></a>前言</h3><p>　　博客的帖子是Markdown格式（后缀名为.md），如果你尚未熟悉，请去进行专门的学习。
　</p>
<h3 id="新建帖子"><a href="#新建帖子" class="headerlink" title="新建帖子"></a>新建帖子</h3><p>　　在终端、博客工程目录下输入：<code>hexo new post test1</code>以创建一个标题名为test1的帖子。你可以在<em>source/_posts/</em>目录下看到它。<br>　　在文件顶部有着与<em>source/categories/index.md</em>和<em>source/tags/index.md</em>相同格式的配置，该类配置可拥有如下属性（comments属性必须保证已经安装了第三方服务后才能生效）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">title: 文章的标题</div><div class="line">date: 创建日期，例如(2017-02-26 00:54:28)</div><div class="line">updated: 修改日期</div><div class="line">comments: 是否开启评论(true or false)</div><div class="line">type: 标签，多个时表示为([a, b, c])</div><div class="line">categories: 分类</div></pre></td></tr></table></figure>
<h3 id="修改创建格式"><a href="#修改创建格式" class="headerlink" title="修改创建格式"></a>修改创建格式</h3><p>　　使用命令创建的帖子文件的格式，系源自于<em>scaffolds/post.md</em>，你可以通过修改它来达到帖子模板化的效果，例如：<br>　　<img src="https://musoucrow.github.io/images/build_bolg/format.png" alt="format"> </p>
<h3 id="后记-4"><a href="#后记-4" class="headerlink" title="后记"></a>后记</h3><p>　　帖子文件的本质就是从模板产生的克隆品，所以也可以自己手动新建文件。同理删除帖子也只需要直接删除文件即可，无需通过网站管理之类的手段，非常方便。</p>
<h2 id="发布网站"><a href="#发布网站" class="headerlink" title="发布网站"></a>发布网站</h2><h3 id="前言-6"><a href="#前言-6" class="headerlink" title="前言"></a>前言</h3><p>　　发布网站的原理其实就是生成网站文件夹并传输到GitHub上对应的仓库<em><a href="https://github.com/username/username.github.io" target="_blank" rel="external">https://github.com/username/username.github.io</a></em>，然后便可通过<em><a href="https://username.github.io" target="_blank" rel="external">https://username.github.io</a></em>进行访问。</p>
<h3 id="上传部署"><a href="#上传部署" class="headerlink" title="上传部署"></a>上传部署</h3><p>　　在终端输入<code>npm install hexo-deployer-git --save</code>，安装完毕后打开<strong>站点配置文件</strong>，添加<em>deploy</em>字段。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repository: http://github.com/username/username.github.io.git</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<ul>
<li>注意事项<ul>
<li>是http而非https。</li>
<li>在旧版(&lt;3.0)的Hexo里是github而非git。</li>
<li>username即你的GitHub用户名，实际以你自己创建的仓库地址为准。</li>
</ul>
</li>
</ul>
<h3 id="生成并上传"><a href="#生成并上传" class="headerlink" title="生成并上传"></a>生成并上传</h3><p>　　在终端、博客工程目录下输入：<code>hexo generate</code>，完成后便会发现新增了<em>public</em>目录。那便是网站文件夹，用于上传到GitHub仓库。<br>　　接下来再输入<code>hexo deploy</code>，将网站文件夹上传到GitHub仓库。以后在本地做了修改后，便进行这两个操作将网站生成并上传即可。</p>
<h3 id="后记-5"><a href="#后记-5" class="headerlink" title="后记"></a>后记</h3><p>　　有时候把一些配置文件搞炸的时候或者上传有问题时，可以使用<code>hexo clean</code>来尝试修复。<br>　　如果觉得GitHub的传输速度过慢，可考虑修改<em>host</em>尝试能否增速，以下是一个江湖偏方：<br>　　<code>151.101.88.249 github.global.ssl.fastly.Net</code>
　    </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Musoucrow" />
          <p class="site-author-name" itemprop="name">Musoucrow</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://coding.net/u/musoucrow" target="_blank" title="Coding">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Coding
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/MusouCrow" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Musoucrow</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"musoucrow"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("yhjLFkD4PnRxISuvmJFRDE0w-gzGzoHsz", "Qw708UVatkDdMTPY8PtLty9O");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  

</body>
</html>
